/*
 * jQote2 - client-side Javascript templating engine
 * Copyright (C) 2010, aefxx
 * http://aefxx.com/
 *
 * Dual licensed under the WTFPL v2 or MIT (X11) licenses
 * WTFPL v2 Copyright (C) 2004, Sam Hocevar
 *
 * Date: Fri, May 4th, 2012
 * Version: 0.9.8
 */
(function($){var h='UndefinedTemplateError',JQOTE2_TMPL_COMP_ERROR='TemplateCompilationError',JQOTE2_TMPL_EXEC_ERROR='TemplateExecutionError';var k='[object Array]',STR='[object String]',FUNC='[object Function]';var o={"(":")","{":"}","[":"]","<":">","‹":"›","«":"»","‘":"’","“":"”"};var n=1,tag=['{{','}}'],qreg=/^[^<]*(<[\w\W]+>)[^>]*$/,type_of=Object.prototype.toString;function raise(a,b){throw($.extend(a,b),a);}function dotted_ns(a){var b=[];if(type_of.call(a)!==k)return false;for(var i=0,l=a.length;i<l;i++)b[i]=a[i].jqote_id;return b.length?b.sort().join('.').replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,'$1$2'):false}function lambda(a,t){var f,fn=[],t=t||tag,type=type_of.call(a);if(type===FUNC)return a.jqote_id?[a]:false;if(type!==k)return[$.jqotec(a,t)];if(type===k)for(var i=0,l=a.length;i<l;i++)if(f=lambda(a[i],t))fn.push(f[0]);return fn.length?fn:false}$.fn.extend({jqote:function(b,c,t){var b=type_of.call(b)===k?b:[b],dom='',context;this.each(function(i){var a=$.jqotec(this,t);for(var j=0;j<b.length;j++){context={that:b[j],data:b,i:i,j:j,parent:c,fn:a};dom+=a.call(b[j],i,j,b,context,a)}});return dom}});$.each({app:'append',pre:'prepend',sub:'html'},function(f,g){$.fn['jqote'+f]=function(b,c,d,t){var e,regexp,str=$.jqote(b,c,d,t),$$=!qreg.test(str)?function(a){return $(document.createTextNode(a))}:function(a){return $("<div/>").html(a).contents()};if(!!(e=dotted_ns(lambda(b))))regexp=new RegExp('(^|\\.)'+e.split('.').join('\\.(.*)?')+'(\\.|$)');return this.each(function(){var a=$$(str);$(this)[g](a);(a[0].nodeType===3?$(this):a).trigger('jqote.'+f,[a,regexp])})}});
$.extend({jqote:function(a,b,c,t){var d='',t=t||tag,context,fn=lambda(a,t);if(fn===false)raise(new Error('Empty or undefined template passed to $.jqote'),{type:h});b=type_of.call(b)!==k?[b]:b;for(var i=0,l=fn.length;i<l;i++){for(var j=0;j<b.length;j++){context={that:b[j],data:b,i:i,j:j,parent:c,fn:fn[i]};d+=fn[i].call(b[j],i,j,b,context,fn[i])}}return d},jqotec:function(a,t){var b,elem,tmpl,t=t||tag,rev,i type=type_of.call(a);var c="",et="";if(type_of.call(t)===k){c=tag[0];et=tag[1]}else{c=tag;rev=c.split('').reverse();for(i=0;i<rev.length;i++){rev[i]=o[rev[i]]||rev[i]}et=rev.join('')}if(type===STR&&qreg.test(a)){elem=tmpl=a;if(b=$.jqotecache[a])return b}else{elem=type===STR||a.nodeType?$(a):a instanceof jQuery?a:null;if(!elem[0]||!(tmpl=elem[0].innerHTML)&&!(tmpl=elem.text()))raise(new Error('Empty or undefined template passed to $.jqotec'),{type:h});if(b=$.jqotecache[$.data(elem[0],'jqote_id')])return b}var d='',index,arr=tmpl.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,'').split(c).join(et+'\x1b').split(et);for(var m=0,l=arr.length;m<l;m++)d+=arr[m].charAt(0)!=='\x1b'?"out+='"+arr[m].replace(/(\\|["'])/g,'\\$1')+"'":(arr[m].charAt(1)==='='?';out+=('+arr[m].substr(2)+');':(arr[m].charAt(1)==='!'?';out+=$.jqotenc(('+arr[m].substr(2)+'));':';'+arr[m].substr(1)));d='try{'+('var out="";'+d+';return out;').split("out+='';").join('').split('var out="";out+=').join('var out=')+'}catch(e){e.type="'+JQOTE2_TMPL_EXEC_ERROR+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var f=new Function('i, j, data, context, fn',d)}catch(e){raise(e,{type:JQOTE2_TMPL_COMP_ERROR})}index=elem instanceof jQuery?$.data(elem[0],'jqote_id',n):elem;return $.jqotecache[index]=(f.jqote_id=n++,f)},
jqotefn:function(a){var b=type_of.call(a),index=b===STR&&qreg.test(a)?a:$.data($(a)[0],'jqote_id');return $.jqotecache[index]||false},jqotetag:function(a){if(type_of.call(a)===STR||type_of.call(a)===k)tag=a},jqotenc:function(a){return(a===undefined?"undefined":(a===null?"null":a)).toString().replace(/&(?!\w+;)/g,'&#38;').split('<').join('&#60;').split('>').join('&#62;').split('"').join('&#34;').split("'").join('&#39;')},jqotecache:{}});$.event.special.jqote={add:function(d){var e,handler=d.handler,data=!d.data?[]:type_of.call(d.data)!==k?[d.data]:d.data;if(!d.namespace)d.namespace='app.pre.sub';if(!data.length||!(e=dotted_ns(lambda(data))))return;d.handler=function(a,b,c){return!c||c.test(e)?handler.apply(this,[a,b]):null}}}})(jQuery);